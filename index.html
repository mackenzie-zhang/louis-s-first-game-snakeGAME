<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LouisÁöÑÂΩ©ËôπË¥™ÂêÉËõá</title>
    <style>
        body {
            margin: 0;
            padding: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: Arial, sans-serif;
            touch-action: none;
            overflow: hidden;
        }
        
        .game-container {
            text-align: center;
            background: white;
            padding: 15px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            max-width: 95vw;
            width: 100%;
            max-width: 500px;
        }
        
        h1 {
            color: #5a67d8;
            margin: 5px 0;
            font-size: clamp(20px, 5vw, 28px);
        }
        
        canvas {
            border: 3px solid #5a67d8;
            border-radius: 10px;
            background: #f0f0f0;
            width: 100%;
            max-width: 400px;
            height: auto;
            touch-action: none;
        }
        
        .score {
            font-size: clamp(18px, 4vw, 24px);
            color: #5a67d8;
            margin: 5px 0;
            font-weight: bold;
        }
        
        .level-info {
            font-size: clamp(16px, 3.5vw, 20px);
            color: #e53e3e;
            margin: 5px 0;
            font-weight: bold;
        }
        
        .lives-info {
            font-size: clamp(14px, 3vw, 18px);
            color: #48bb78;
            margin: 5px 0;
            font-weight: bold;
        }
        
        .skill-info {
            font-size: clamp(14px, 3vw, 18px);
            color: #48bb78;
            margin: 5px 0;
            font-weight: bold;
            min-height: 20px;
        }
        
        .controls {
            margin-top: 15px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
        }
        
        button {
            background: #5a67d8;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: clamp(14px, 3vw, 18px);
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
        }
        
        button:hover {
            background: #667eea;
            transform: scale(1.05);
        }
        
        .skill-button {
            background: #48bb78;
            padding: 10px 20px;
            font-size: 16px;
            margin-top: 10px;
        }
        
        .skill-button:hover {
            background: #38a169;
        }
        
        .skill-button:disabled {
            background: #cbd5e0;
            cursor: not-allowed;
            transform: scale(1);
        }
        
        .instructions {
            margin-top: 20px;
            color: #5a67d8;
            font-size: 16px;
        }
        
        .game-over, .level-select, .leaderboard-modal, .name-input-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            text-align: center;
            z-index: 1000;
            max-width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .game-over h2 {
            color: #e53e3e;
            margin-bottom: 10px;
        }
        
        .level-select h2, .leaderboard-modal h2 {
            color: #5a67d8;
            margin-bottom: 20px;
        }
        
        .level-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .level-button {
            background: #48bb78;
            padding: 15px 40px;
            font-size: 20px;
            transition: all 0.3s;
        }
        
        .level-button:hover {
            background: #38a169;
            transform: scale(1.1);
        }
        
        .level-button:disabled {
            background: #cbd5e0;
            cursor: not-allowed;
            transform: scale(1);
        }
        
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
        }
        
        .food-effect {
            position: absolute;
            font-size: 30px;
            animation: foodPop 0.5s ease-out;
            pointer-events: none;
        }
        
        .message-popup {
            position: absolute;
            font-size: 24px;
            font-weight: bold;
            color: #e53e3e;
            animation: messageFade 2s ease-out;
            pointer-events: none;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        @keyframes foodPop {
            0% {
                transform: scale(1) translateY(0);
                opacity: 1;
            }
            100% {
                transform: scale(2) translateY(-30px);
                opacity: 0;
            }
        }
        
        @keyframes messageFade {
            0% {
                transform: scale(0.5);
                opacity: 0;
            }
            20% {
                transform: scale(1.2);
                opacity: 1;
            }
            80% {
                transform: scale(1);
                opacity: 1;
            }
            100% {
                transform: scale(0.8);
                opacity: 0;
            }
        }
        
        .projectile {
            position: absolute;
            font-size: 20px;
            transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        
        .leaderboard-table {
            margin: 20px 0;
            width: 100%;
            border-collapse: collapse;
        }
        
        .leaderboard-table th, .leaderboard-table td {
            padding: 10px;
            text-align: center;
            border: 1px solid #e2e8f0;
        }
        
        .leaderboard-table th {
            background: #5a67d8;
            color: white;
            font-weight: bold;
        }
        
        .leaderboard-table tr:nth-child(even) {
            background: #f7fafc;
        }
        
        .leaderboard-table tr:first-child td {
            background: #ffd700;
            font-weight: bold;
        }
        
        .leaderboard-table tr:nth-child(2) td {
            background: #c0c0c0;
            font-weight: bold;
        }
        
        .leaderboard-table tr:nth-child(3) td {
            background: #cd7f32;
            font-weight: bold;
        }
        
        .name-input {
            margin: 20px 0;
        }
        
        .name-input input {
            padding: 10px 20px;
            font-size: 18px;
            border: 2px solid #5a67d8;
            border-radius: 10px;
            width: 200px;
            text-align: center;
        }
        
        .touch-controls {
            display: none;
            margin-top: 20px;
            gap: 10px;
        }
        
        .touch-row {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        
        .touch-button {
            background: #667eea;
            color: white;
            border: none;
            width: 80px;
            height: 80px;
            font-size: 30px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.2s;
            user-select: none;
            -webkit-user-select: none;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .touch-button:active {
            background: #5a67d8;
            transform: scale(0.95);
        }
        
        .touch-button.skill {
            background: #48bb78;
            width: auto;
            padding: 0 30px;
        }
        
        .touch-button.skill:active {
            background: #38a169;
        }
        
        @media (max-width: 768px) {
            .touch-controls {
                display: grid;
            }
            
            .instructions {
                display: none;
            }
            
            .game-container {
                padding: 10px;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            button {
                width: 90%;
                max-width: 200px;
            }
        }
        .heart {
            color: #e53e3e;
            font-size: 20px;
            display: inline-block;
            animation: heartBeat 1s infinite;
        }
        
        @keyframes heartBeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>üåà LouisÁöÑÂΩ©ËôπË¥™ÂêÉËõá üêç</h1>
        <div class="level-info">Á¨¨ <span id="currentLevel">1</span> ÂÖ≥</div>
        <div class="score">ÂæóÂàÜ: <span id="score">0</span> ÂàÜ</div>
        <div class="lives-info" id="livesInfo"></div>
        <div class="skill-info" id="skillInfo"></div>
        <canvas id="gameCanvas" width="400" height="400"></canvas>
        
        <div class="controls">
            <button onclick="showLevelSelect()">ÂºÄÂßãÊ∏∏Êàè</button>
            <button onclick="pauseGame()">ÊöÇÂÅú</button>
            <button onclick="showLeaderboard()">ÊéíË°åÊ¶ú</button>
        </div>
        
        <button id="skillButton" class="skill-button" onclick="useSkill()" style="display: none;">
            ‰ΩøÁî®ËøúÁ®ãÂêÉÊäÄËÉΩ (Á©∫Ê†ºÈîÆ)
        </button>
        
        <div class="touch-controls" id="touchControls">
            <div class="touch-row">
                <button class="touch-button" ontouchstart="handleTouchControl('up')" onmousedown="handleTouchControl('up')">‚Üë</button>
            </div>
            <div class="touch-row">
                <button class="touch-button" ontouchstart="handleTouchControl('left')" onmousedown="handleTouchControl('left')">‚Üê</button>
                <button class="touch-button skill" ontouchstart="useSkill()" onmousedown="useSkill()" id="touchSkillButton" style="display: none;">üêü</button>
                <button class="touch-button" ontouchstart="handleTouchControl('right')" onmousedown="handleTouchControl('right')">‚Üí</button>
            </div>
            <div class="touch-row">
                <button class="touch-button" ontouchstart="handleTouchControl('down')" onmousedown="handleTouchControl('down')">‚Üì</button>
            </div>
        </div>
        
        <div class="instructions">
            <p>‰ΩøÁî®ÊñπÂêëÈîÆ ‚Üë ‚Üì ‚Üê ‚Üí ÊéßÂà∂Â∞èËõá</p>
            <p id="skillInstruction" style="display: none;">ÊåâÁ©∫Ê†ºÈîÆ‰ΩøÁî®ËøúÁ®ãÂêÉÊäÄËÉΩÔºÅ</p>
        </div>
    </div>
    
    <div class="overlay" id="overlay"></div>
    
    <div class="level-select" id="levelSelect">
        <h2>üéÆ ÈÄâÊã©ÂÖ≥Âç° üéÆ</h2>
        <div class="level-buttons">
            <button class="level-button" onclick="startLevel(1)">Á¨¨1ÂÖ≥ - ÊÖ¢ÊÖ¢Áà¨ üê¢</button>
            <button class="level-button" id="level2Button" onclick="startLevel(2)">Á¨¨2ÂÖ≥ - Ê≠£Â∏∏ÈÄüÂ∫¶ üêç</button>
            <button class="level-button" id="level3Button" onclick="startLevel(3)">Á¨¨3ÂÖ≥ - Âø´Âø´Ë∑ë üöÄ</button>
            <button class="level-button" id="level4Button" onclick="startLevel(4)">Á¨¨4ÂÖ≥ - Ë∂ÖÁ∫ßÂø´ ‚ö° (+1ÂëΩ)</button>
            <button class="level-button" id="level5Button" onclick="startLevel(5)">Á¨¨5ÂÖ≥ - Èó™Áîµ‰æ† ‚ö°‚ö°</button>
            <button class="level-button" id="level6Button" onclick="startLevel(6)">Á¨¨6ÂÖ≥ - ÂÖâÈÄü üí´</button>
            <button class="level-button" id="level7Button" onclick="startLevel(7)">Á¨¨7ÂÖ≥ - ÁªàÊûÅÊåëÊàò üî•</button>
        </div>
    </div>
    
    <div class="game-over" id="gameOver">
        <h2>Ê∏∏ÊàèÁªìÊùüÔºÅ</h2>
        <p>ÊúÄÁªàÂæóÂàÜ: <span id="finalScore">0</span> ÂàÜ</p>
        <p>ÊÄªÂàÜ: <span id="totalScore">0</span> ÂàÜ</p>
        <button onclick="checkHighScore()">Êèê‰∫§ÂàÜÊï∞</button>
        <button onclick="showLevelSelect()">ÈÄâÊã©ÂÖ≥Âç°</button>
        <button onclick="restartGame()">ÂÜçÁé©‰∏ÄÊ¨°</button>
    </div>
    
    <div class="name-input-modal" id="nameInputModal">
        <h2>üèÜ ÊÅ≠ÂñúÔºÅ‰Ω†ËøõÂÖ•‰∫ÜÂâç10ÂêçÔºÅ üèÜ</h2>
        <p>‰Ω†ÁöÑÊÄªÂàÜ: <span id="highScoreDisplay">0</span> ÂàÜ</p>
        <div class="name-input">
            <input type="text" id="playerName" placeholder="ËæìÂÖ•‰Ω†ÁöÑÂêçÂ≠ó" maxlength="10">
        </div>
        <button onclick="submitHighScore()">Êèê‰∫§</button>
        <button onclick="cancelSubmit()">ÂèñÊ∂à</button>
    </div>
    
    <div class="leaderboard-modal" id="leaderboardModal">
        <h2>üèÜ ÊéíË°åÊ¶ú TOP 10 üèÜ</h2>
        <table class="leaderboard-table">
            <thead>
                <tr>
                    <th>ÊéíÂêç</th>
                    <th>Áé©ÂÆ∂</th>
                    <th>ÊÄªÂàÜ</th>
                    <th>Êó•Êúü</th>
                </tr>
            </thead>
            <tbody id="leaderboardBody"></tbody>
        </table>
        <button onclick="closeLeaderboard()">ÂÖ≥Èó≠</button>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreElement = document.getElementById('score');
        const levelElement = document.getElementById('currentLevel');
        const gameOverDiv = document.getElementById('gameOver');
        const levelSelectDiv = document.getElementById('levelSelect');
        const overlay = document.getElementById('overlay');
        const finalScoreElement = document.getElementById('finalScore');
        const totalScoreElement = document.getElementById('totalScore');
        const skillButton = document.getElementById('skillButton');
        const skillInfo = document.getElementById('skillInfo');
        const skillInstruction = document.getElementById('skillInstruction');
        const livesInfo = document.getElementById('livesInfo');
        const leaderboardModal = document.getElementById('leaderboardModal');
        const nameInputModal = document.getElementById('nameInputModal');
        const highScoreDisplay = document.getElementById('highScoreDisplay');
        const touchControls = document.getElementById('touchControls');
        const touchSkillButton = document.getElementById('touchSkillButton');
        
        // Ê∏∏ÊàèËÆæÁΩÆ
        const gridSize = 20;
        const tileCount = canvas.width / gridSize;
        
        // Ëß¶Êë∏ÊéßÂà∂Â§ÑÁêÜ
        function handleTouchControl(direction) {
            if (!gameRunning || gamePaused) return;
            
            switch(direction) {
                case 'up':
                    if (dy === 0) {
                        dx = 0;
                        dy = -1;
                    }
                    break;
                case 'down':
                    if (dy === 0) {
                        dx = 0;
                        dy = 1;
                    }
                    break;
                case 'left':
                    if (dx === 0) {
                        dx = -1;
                        dy = 0;
                    }
                    break;
                case 'right':
                    if (dx === 0) {
                        dx = 1;
                        dy = 0;
                    }
                    break;
            }
        }
        
        // Ëß¶Êë∏ÊªëÂä®ÊéßÂà∂
        let touchStartX = 0;
        let touchStartY = 0;
        
        canvas.addEventListener('touchstart', (e) => {
            touchStartX = e.touches[0].clientX;
            touchStartY = e.touches[0].clientY;
            e.preventDefault();
        });
        
        canvas.addEventListener('touchend', (e) => {
            if (!gameRunning || gamePaused) return;
            
            const touchEndX = e.changedTouches[0].clientX;
            const touchEndY = e.changedTouches[0].clientY;
            
            const diffX = touchEndX - touchStartX;
            const diffY = touchEndY - touchStartY;
            
            if (Math.abs(diffX) > Math.abs(diffY)) {
                // Ê∞¥Âπ≥ÊªëÂä®
                if (diffX > 30) {
                    handleTouchControl('right');
                } else if (diffX < -30) {
                    handleTouchControl('left');
                }
            } else {
                // ÂûÇÁõ¥ÊªëÂä®
                if (diffY > 30) {
                    handleTouchControl('down');
                } else if (diffY < -30) {
                    handleTouchControl('up');
                }
            }
            
            e.preventDefault();
        });
        
        // Èò≤Ê≠¢È°µÈù¢ÊªöÂä®
        document.addEventListener('touchmove', (e) => {
            if (e.target === canvas) {
                e.preventDefault();
            }
        }, { passive: false });
        
        // Ê£ÄÊµãÊòØÂê¶‰∏∫ÁßªÂä®ËÆæÂ§á
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth <= 768;
        
        // ËÆæÁΩÆÁîªÂ∏ÉÂ§ßÂ∞è
        function resizeCanvas() {
            const container = document.querySelector('.game-container');
            const maxSize = Math.min(container.clientWidth - 30, 400);
            canvas.width = maxSize;
            canvas.height = maxSize;
        }
        
        // Ë∞ÉÊï¥ÁîªÂ∏ÉÂ§ßÂ∞è
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();
        
        let snake = [{x: 10, y: 10}];
        let foods = [];
        let dx = 0;
        let dy = 0;
        let score = 0;
        let totalGameScore = 0;
        let gameRunning = false;
        let gamePaused = false;
        let currentLevel = 1;
        let gameSpeed = 150;
        let gameInterval = null;
        let completedLevels = [];
        let skillUnlocked = false;
        let skillCooldown = 0;
        let skillCooldownInterval = null;
        let lives = 1;
        let maxLives = 1;
        
        // ÂàõÂª∫Èü≥È¢ë‰∏ä‰∏ãÊñá
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        
        // Êí≠ÊîæÊ¨¢‰πêÁöÑÂêÉÈ£üÁâ©Èü≥Êïà
        function playEatSound() {
            // ÂàõÂª∫Ë∂ÖÁ∫ßÊ¨¢‰πêÁöÑÂèÆÂΩìÂ£∞
            const notes = [261.63, 329.63, 392.00, 523.25, 659.25, 783.99, 1046.50]; // C4Âà∞C6
            
            notes.forEach((freq, index) => {
                setTimeout(() => {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.type = index % 2 === 0 ? 'sine' : 'triangle';
                    oscillator.frequency.setValueAtTime(freq, audioContext.currentTime);
                    
                    // Âä†ÂÖ•‰∏ÄÁÇπÈ¢§Èü≥ÊïàÊûú
                    const vibrato = audioContext.createOscillator();
                    vibrato.frequency.value = 5;
                    const vibratoGain = audioContext.createGain();
                    vibratoGain.gain.value = 10;
                    vibrato.connect(vibratoGain);
                    vibratoGain.connect(oscillator.frequency);
                    vibrato.start();
                    
                    gainNode.gain.setValueAtTime(0.4, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.3);
                    vibrato.stop(audioContext.currentTime + 0.3);
                }, index * 40);
            });
        }
        
        // Êí≠ÊîæÂ§±Ë¥•Èü≥Êïà
        function playMissSound() {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.type = 'sawtooth';
            oscillator.frequency.setValueAtTime(200, audioContext.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(100, audioContext.currentTime + 0.3);
            
            gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.3);
        }
        
        // Êí≠ÊîæÊäÄËÉΩÈü≥Êïà
        function playSkillSound() {
            // ÂèëÂ∞ÑÈü≥Êïà
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.type = 'square';
            oscillator.frequency.setValueAtTime(440, audioContext.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(880, audioContext.currentTime + 0.1);
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.2);
        }
        
        // Êí≠ÊîæÂçáÁ∫ßÈü≥Êïà
        function playLevelUpSound() {
            const notes = [261.63, 329.63, 392.00, 523.25, 659.25];
            
            notes.forEach((freq, index) => {
                setTimeout(() => {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.type = 'triangle';
                    oscillator.frequency.setValueAtTime(freq, audioContext.currentTime);
                    
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.3);
                }, index * 100);
            });
        }
        
        // Êí≠ÊîæÊ∏∏ÊàèÁªìÊùüÈü≥Êïà
        function playGameOverSound() {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.type = 'sawtooth';
            oscillator.frequency.setValueAtTime(440, audioContext.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(110, audioContext.currentTime + 0.5);
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.5);
        }
        
        // Êí≠ÊîæÈ¢ùÂ§ñÁîüÂëΩÈü≥Êïà
        function playExtraLifeSound() {
            const notes = [523.25, 587.33, 659.25, 783.99]; // C5, D5, E5, G5
            
            notes.forEach((freq, index) => {
                setTimeout(() => {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.type = 'sine';
                    oscillator.frequency.setValueAtTime(freq, audioContext.currentTime);
                    
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.4);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.4);
                }, index * 100);
            });
        }
        
        // ÂΩ©ËôπÈ¢úËâ≤Êï∞ÁªÑ
        const rainbowColors = [
            '#FF0000', '#FF7F00', '#FFFF00', '#00FF00', 
            '#0000FF', '#4B0082', '#9400D3'
        ];
        
        // È£üÁâ©Ë°®ÊÉÖ
        const foodEmojis = ['üçé', 'üçì', 'üçä', 'üçã', 'üçá', 'üçâ', 'üçí', 'üçå', 'ü•ù', 'üçë'];
        
        // ÊòæÁ§∫Ê∂àÊÅØ
        function showMessage(message, x, y) {
            const msg = document.createElement('div');
            msg.className = 'message-popup';
            msg.textContent = message;
            msg.style.left = (canvas.offsetLeft + x * gridSize) + 'px';
            msg.style.top = (canvas.offsetTop + y * gridSize - 40) + 'px';
            document.body.appendChild(msg);
            
            setTimeout(() => {
                msg.remove();
            }, 2000);
        }
        
        // Êõ¥Êñ∞ÁîüÂëΩÊòæÁ§∫
        function updateLivesDisplay() {
            if (currentLevel >= 4) {
                const hearts = '<span class="heart">‚ù§Ô∏è</span>'.repeat(lives);
                livesInfo.innerHTML = `ÁîüÂëΩ: ${hearts}`;
                livesInfo.style.display = 'block';
            } else {
                livesInfo.style.display = 'none';
            }
        }
        
        // ‰ΩøÁî®ÊäÄËÉΩ
        function useSkill() {
            if (!gameRunning || gamePaused || skillCooldown > 0 || !skillUnlocked) return;
            
            const head = snake[0];
            let targetFood = null;
            let minDistance = Infinity;
            
            // ÊâæÂà∞ÊúÄËøëÁöÑÈ£üÁâ©Ôºà‰∏çÈôêÂà∂Âêå‰∏ÄË°åÔºâ
            foods.forEach(food => {
                const distance = Math.abs(food.x - head.x) + Math.abs(food.y - head.y);
                if (distance < minDistance) {
                    minDistance = distance;
                    targetFood = food;
                }
            });
            
            if (targetFood) {
                // Êí≠ÊîæÊäÄËÉΩÈü≥Êïà
                playSkillSound();
                
                // ÂàõÂª∫ÂèëÂ∞ÑÁöÑÂ∞èÈ±º
                const projectile = document.createElement('div');
                projectile.className = 'projectile';
                projectile.textContent = 'üêü';
                projectile.style.left = (canvas.offsetLeft + head.x * gridSize) + 'px';
                projectile.style.top = (canvas.offsetTop + head.y * gridSize) + 'px';
                document.body.appendChild(projectile);
                
                // ÁßªÂä®Â∞èÈ±ºÂà∞ÁõÆÊ†áÔºàÊõ≤Á∫øË∑ØÂæÑÔºâ
                setTimeout(() => {
                    projectile.style.transition = 'all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
                    projectile.style.left = (canvas.offsetLeft + targetFood.x * gridSize) + 'px';
                    projectile.style.top = (canvas.offsetTop + targetFood.y * gridSize) + 'px';
                }, 50);
                
                // ÂêÉÊéâÈ£üÁâ©
                setTimeout(() => {
                    projectile.remove();
                    
                    // ÁßªÈô§È£üÁâ©Âπ∂Âä†ÂàÜ
                    const foodIndex = foods.indexOf(targetFood);
                    if (foodIndex !== -1) {
                        foods.splice(foodIndex, 1);
                        score += 10;
                        scoreElement.textContent = score;
                        playEatSound();
                        createFoodEffect(targetFood.x, targetFood.y, targetFood.emoji);
                        generateSingleFood();
                        
                        // Ëõá‰πüË¶ÅÂèòÈïø
                        snake.push({...snake[snake.length - 1]});
                    }
                }, 550);
                
                // ÂºÄÂßãÂÜ∑Âç¥
                skillCooldown = 30;
                updateSkillButton();
                
                if (skillCooldownInterval) {
                    clearInterval(skillCooldownInterval);
                }
                
                skillCooldownInterval = setInterval(() => {
                    skillCooldown--;
                    updateSkillButton();
                    if (skillCooldown <= 0) {
                        clearInterval(skillCooldownInterval);
                        skillCooldownInterval = null;
                    }
                }, 1000);
            } else {
                // Ê≤°ÊúâÂêåË°åÁöÑÈ£üÁâ©
                playMissSound();
                showMessage("‰∏ãÊ¨°ÂÜçÂä™ÂäõÔºÅ", head.x, head.y);
            }
        }
        
        // Êõ¥Êñ∞ÊäÄËÉΩÊåâÈíÆ
        function updateSkillButton() {
            if (!skillUnlocked) {
                skillButton.style.display = 'none';
                touchSkillButton.style.display = 'none';
                skillInfo.textContent = '';
                return;
            }
            
            skillButton.style.display = 'block';
            if (isMobile && gameRunning) {
                touchSkillButton.style.display = 'flex';
            }
            
            if (skillCooldown > 0) {
                skillButton.disabled = true;
                touchSkillButton.disabled = true;
                skillButton.textContent = `ÊäÄËÉΩÂÜ∑Âç¥‰∏≠ (${skillCooldown}Áßí)`;
                touchSkillButton.textContent = `${skillCooldown}`;
                skillInfo.textContent = `‚è±Ô∏è ÊäÄËÉΩÂÜ∑Âç¥: ${skillCooldown}Áßí`;
            } else {
                skillButton.disabled = false;
                touchSkillButton.disabled = false;
                skillButton.textContent = '‰ΩøÁî®ËøúÁ®ãÂêÉÊäÄËÉΩ (Á©∫Ê†ºÈîÆ)';
                touchSkillButton.textContent = 'üêü';
                skillInfo.textContent = 'üêü ËøúÁ®ãÂêÉÊäÄËÉΩÂ∑≤Â∞±Áª™ÔºÅ';
            }
        }
        
        // ÁîüÊàêÂçï‰∏™È£üÁâ©
        function generateSingleFood() {
            const actualTileCount = Math.floor(canvas.width / gridSize);
            let newFood;
            let attempts = 0;
            do {
                newFood = {
                    x: Math.floor(Math.random() * actualTileCount),
                    y: Math.floor(Math.random() * actualTileCount),
                    emoji: foodEmojis[Math.floor(Math.random() * foodEmojis.length)]
                };
                attempts++;
                let valid = true;
                for (let segment of snake) {
                    if (segment.x === newFood.x && segment.y === newFood.y) {
                        valid = false;
                        break;
                    }
                }
                for (let food of foods) {
                    if (food.x === newFood.x && food.y === newFood.y) {
                        valid = false;
                        break;
                    }
                }
                if (valid) {
                    foods.push(newFood);
                    return;
                }
            } while (attempts < 100);
        }
        
        // ÂàùÂßãÂåñÈ£üÁâ©
        function initializeFoods() {
            foods = [];
            for (let i = 0; i < 3; i++) {
                generateSingleFood();
            }
        }
        
        // ÂàõÂª∫È£üÁâ©Âä®ÁîªÊïàÊûú
        function createFoodEffect(x, y, emoji) {
            const effect = document.createElement('div');
            effect.className = 'food-effect';
            effect.textContent = emoji;
            effect.style.left = (canvas.offsetLeft + x * gridSize) + 'px';
            effect.style.top = (canvas.offsetTop + y * gridSize - 20) + 'px';
            document.body.appendChild(effect);
            
            setTimeout(() => {
                effect.remove();
            }, 500);
        }
        
        // ÁªòÂà∂Ê∏∏Êàè
        function draw() {
            const actualTileCount = canvas.width / gridSize;
            
            ctx.fillStyle = '#f0f0f0';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // ÁªòÂà∂ÁΩëÊ†º
            ctx.strokeStyle = '#e0e0e0';
            ctx.lineWidth = 1;
            for (let i = 0; i <= actualTileCount; i++) {
                ctx.beginPath();
                ctx.moveTo(i * gridSize, 0);
                ctx.lineTo(i * gridSize, canvas.height);
                ctx.stroke();
                
                ctx.beginPath();
                ctx.moveTo(0, i * gridSize);
                ctx.lineTo(canvas.width, i * gridSize);
                ctx.stroke();
            }
            
            // ÁªòÂà∂Ëõá
            snake.forEach((segment, index) => {
                const colorIndex = index % rainbowColors.length;
                ctx.fillStyle = rainbowColors[colorIndex];
                ctx.fillRect(segment.x * gridSize + 2, segment.y * gridSize + 2, 
                           gridSize - 4, gridSize - 4);
                
                // ÁªòÂà∂ËõáÂ§¥
                if (index === 0) {
                    ctx.fillStyle = 'white';
                    ctx.beginPath();
                    ctx.arc(segment.x * gridSize + 6, segment.y * gridSize + 6, 2, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.beginPath();
                    ctx.arc(segment.x * gridSize + 14, segment.y * gridSize + 6, 2, 0, Math.PI * 2);
                    ctx.fill();
                    
                    ctx.fillStyle = 'black';
                    ctx.beginPath();
                    ctx.arc(segment.x * gridSize + 6, segment.y * gridSize + 6, 1, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.beginPath();
                    ctx.arc(segment.x * gridSize + 14, segment.y * gridSize + 6, 1, 0, Math.PI * 2);
                    ctx.fill();
                }
            });
            
            // ÁªòÂà∂È£üÁâ©
            foods.forEach(food => {
                ctx.font = `${gridSize - 4}px Arial`;
                ctx.fillText(food.emoji, food.x * gridSize + 2, food.y * gridSize + gridSize - 4);
            });
        }
        
        // Êõ¥Êñ∞Ê∏∏ÊàèÁä∂ÊÄÅ
        function update() {
            if (!gameRunning || gamePaused) return;
            
            if (dx === 0 && dy === 0) return;
            
            const actualTileCount = Math.floor(canvas.width / gridSize);
            const head = {x: snake[0].x + dx, y: snake[0].y + dy};
            
            // Ê£ÄÊü•Â¢ôÂ£ÅÁ¢∞Êíû
            if (head.x < 0 || head.x >= actualTileCount || head.y < 0 || head.y >= actualTileCount) {
                handleDeath();
                return;
            }
            
            // Ê£ÄÊü•Ëá™Ë∫´Á¢∞Êíû
            for (let segment of snake) {
                if (head.x === segment.x && head.y === segment.y) {
                    handleDeath();
                    return;
                }
            }
            
            snake.unshift(head);
            
            // Ê£ÄÊü•ÊòØÂê¶ÂêÉÂà∞È£üÁâ©
            let ateFood = false;
            for (let i = 0; i < foods.length; i++) {
                if (head.x === foods[i].x && head.y === foods[i].y) {
                    score += 10;
                    scoreElement.textContent = score;
                    
                    playEatSound();
                    createFoodEffect(foods[i].x, foods[i].y, foods[i].emoji);
                    
                    foods.splice(i, 1);
                    generateSingleFood();
                    
                    ateFood = true;
                    break;
                }
            }
            
            if (!ateFood) {
                snake.pop();
            }
            
            // Ê£ÄÊü•ÊòØÂê¶ÈÄöÂÖ≥
            if (score >= currentLevel * 30) {
                levelComplete();
            }
            
            draw();
        }
        
        // Â§ÑÁêÜÊ≠ª‰∫°
        function handleDeath() {
            if (lives > 1) {
                lives--;
                updateLivesDisplay();
                playMissSound();
                showMessage("ËøòÊúâ‰∏ÄÊ¨°Êú∫‰ºöÔºÅ", Math.floor(canvas.width / gridSize / 2), Math.floor(canvas.height / gridSize / 2));
                
                // ÈáçÁΩÆËõáÁöÑ‰ΩçÁΩÆ
                const startX = Math.floor(canvas.width / gridSize / 2);
                const startY = Math.floor(canvas.height / gridSize / 2);
                snake = [{x: startX, y: startY}];
                dx = 0;
                dy = 0;
                draw();
            } else {
                gameOver();
            }
        }
        
        // ÂÖ≥Âç°ÂÆåÊàê
        function levelComplete() {
            gameRunning = false;
            if (gameInterval) {
                clearInterval(gameInterval);
                gameInterval = null;
            }
            
            // Á¥ØÂä†ÊÄªÂàÜ
            totalGameScore += score;
            
            if (!completedLevels.includes(currentLevel)) {
                completedLevels.push(currentLevel);
                localStorage.setItem('completedLevels', JSON.stringify(completedLevels));
            }
            
            // Á¨¨‰∏ÄÂÖ≥ÂÆåÊàêËß£ÈîÅÊäÄËÉΩ
            if (currentLevel === 1 && !skillUnlocked) {
                skillUnlocked = true;
                localStorage.setItem('skillUnlocked', 'true');
                alert('ÊÅ≠ÂñúÔºÅ‰Ω†Ëß£ÈîÅ‰∫ÜËøúÁ®ãÂêÉÊäÄËÉΩÔºÅÊåâÁ©∫Ê†ºÈîÆ‰ΩøÁî®ÔºÅ');
            }
            
            playLevelUpSound();
            
            if (currentLevel === 7) {
                alert(`ÊÅ≠ÂñúÈÄöËøáÊâÄÊúâÂÖ≥Âç°ÔºÅÊÄªÂàÜ: ${totalGameScore}`);
                finalScoreElement.textContent = score;
                totalScoreElement.textContent = totalGameScore;
                overlay.style.display = 'block';
                gameOverDiv.style.display = 'block';
            } else {
                alert(`ÊÅ≠ÂñúÈÄöËøáÁ¨¨${currentLevel}ÂÖ≥ÔºÅ`);
                showLevelSelect();
            }
        }
        
        // Ê∏∏ÊàèÁªìÊùü
        function gameOver() {
            gameRunning = false;
            playGameOverSound();
            
            // Á¥ØÂä†ÊÄªÂàÜ
            totalGameScore += score;
            
            finalScoreElement.textContent = score;
            totalScoreElement.textContent = totalGameScore;
            overlay.style.display = 'block';
            gameOverDiv.style.display = 'block';
            if (gameInterval) {
                clearInterval(gameInterval);
                gameInterval = null;
            }
            if (skillCooldownInterval) {
                clearInterval(skillCooldownInterval);
                skillCooldownInterval = null;
            }
        }
        
        // Ê£ÄÊü•ÊòØÂê¶ËøõÂÖ•ÊéíË°åÊ¶ú
async function checkHighScore() {
    // ÂêåÊ†∑ÔºåÂøÖÈ°ªÁî® await Á≠âÂæÖ
    const leaderboard = await getLeaderboard();
    
    if (leaderboard.length < 10 || totalGameScore > (leaderboard[9]?.score || 0) ) {
        highScoreDisplay.textContent = totalGameScore;
        overlay.style.display = 'block';
        gameOverDiv.style.display = 'none';
        nameInputModal.style.display = 'block';
    } else {
        // showLeaderboard Â∑≤ÁªèÊîπÊàê‰∫ÜÂºÇÊ≠•ÁöÑÔºåÊâÄ‰ª•ËøôÈáåË∞ÉÁî®ÂÆÉÊ≤°ÈóÆÈ¢ò
        showLeaderboard();
    }
}

        // Êèê‰∫§È´òÂàÜ
async function submitHighScore() {
    console.log("Ê≠•È™§1ÔºöÂºÄÂßãÊèê‰∫§ÂàÜÊï∞...");
    const playerName = document.getElementById('playerName').value.trim();
    if (!playerName) {
        alert('ËØ∑ËæìÂÖ•‰Ω†ÁöÑÂêçÂ≠óÔºÅ');
        return;
    }

    try {
        const leaderboard = await getLeaderboard();
        console.log("Ê≠•È™§2ÔºöÊàêÂäü‰ªéAPIËé∑ÂèñÂà∞ÂΩìÂâçÊéíË°åÊ¶ú", leaderboard);

        const date = new Date().toLocaleDateString('zh-CN');
        leaderboard.push({
            name: playerName,
            score: totalGameScore,
            date: date
        });

        leaderboard.sort((a, b) => b.score - a.score);
        leaderboard.splice(10);
        console.log("Ê≠•È™§3ÔºöÊú¨Âú∞Â∑≤ÁîüÊàêÊñ∞ÁöÑÊéíË°åÊ¶úÔºåÂáÜÂ§áÂèëÈÄÅÂà∞API", leaderboard);

        const response = await fetch('/api/setLeaderboard', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(leaderboard),
        });
        console.log("Ê≠•È™§4ÔºösetLeaderboard API ÂìçÂ∫îÂ∑≤Êî∂Âà∞", response);

        if (!response.ok) {
            // Â¶ÇÊûúAPIËøîÂõûÁöÑ‰∏çÊòØÊàêÂäüÁä∂ÊÄÅÁ†ÅÔºåÂ∞±ÊäõÂá∫ÈîôËØØ
            throw new Error(`APIËøîÂõûÈîôËØØÔºåÁä∂ÊÄÅÁ†Å: ${response.status}`);
        }

        console.log("Ê≠•È™§5ÔºöÂáÜÂ§áË∞ÉÁî® showLeaderboard Êù•ÊòæÁ§∫ÊúÄÁªàÁªìÊûú...");
        showLeaderboard();

    } catch (error) {
        // ËøôÈáåÁöÑÈîôËØØ‰ºöÂëäËØâÊàë‰ª¨ÊòØÂì™‰∏ÄÊ≠•Âá∫Èîô‰∫Ü
        console.error("Êèê‰∫§ËøáÁ®ã‰∏≠Êñ≠ÔºÅÈîôËØØËØ¶ÊÉÖ:", error);
        alert('ÁΩëÁªúÈîôËØØÔºåÊèê‰∫§ÂàÜÊï∞Â§±Ë¥•„ÄÇËØ∑Á®çÂêéÂÜçËØï„ÄÇ');
    }
}
        
        // ÂèñÊ∂àÊèê‰∫§
        function cancelSubmit() {
            nameInputModal.style.display = 'none';
            showLevelSelect();
        }
        
        // Ëé∑ÂèñÊéíË°åÊ¶ú
        async function getLeaderboard() {
    try {
        // ÂéªËØ∑Ê±ÇÊàë‰ª¨ÂàöÂàöÂÜôÁöÑÁ¨¨‰∏Ä‰∏™APIÊñá‰ª∂
        const response = await fetch('/api/getLeaderboard');
        if (!response.ok) {
            console.error("Failed to fetch leaderboard from server.");
            return []; // Â¶ÇÊûúÂ§±Ë¥•ÔºåËøîÂõûÁ©∫Êï∞ÁªÑ
        }
        const data = await response.json();
        return data;
    } catch (error) {
        console.error("Error fetching leaderboard:", error);
        return [];
    }
        
    
    if (leaderboard.length === 0) {
        const row = tbody.insertRow();
        const cell = row.insertCell(0);
        cell.colSpan = 4;
        cell.textContent = 'Ê≠£Âú®Âä†ËΩΩÊàñÊöÇÊó†ËÆ∞ÂΩï...';
        cell.style.textAlign = 'center';
    }
    
    overlay.style.display = 'block';
    leaderboardModal.style.display = 'block';
    gameOverDiv.style.display = 'none';
    nameInputModal.style.display = 'none';
}
        
        // ÂÖ≥Èó≠ÊéíË°åÊ¶ú
        function closeLeaderboard() {
            leaderboardModal.style.display = 'none';
            overlay.style.display = 'none';
        }
        
        // ÊòæÁ§∫ÂÖ≥Âç°ÈÄâÊã©
        function showLevelSelect() {
            overlay.style.display = 'block';
            levelSelectDiv.style.display = 'block';
            gameOverDiv.style.display = 'none';
            totalGameScore = 0; // ÈáçÁΩÆÊÄªÂàÜ
            
            updateLevelButtons();
        }
        
        // Êõ¥Êñ∞ÂÖ≥Âç°ÊåâÈíÆ
        function updateLevelButtons() {
            // Êõ¥Êñ∞Ëß£ÈîÅÁä∂ÊÄÅ
            for (let i = 2; i <= 7; i++) {
                const button = document.getElementById(`level${i}Button`);
                if (completedLevels.includes(i - 1)) {
                    button.disabled = false;
                } else {
                    button.disabled = true;
                    button.textContent = `Á¨¨${i}ÂÖ≥ - ÈúÄË¶ÅÈÄöËøáÁ¨¨${i-1}ÂÖ≥`;
                }
            }
            
            // ÊÅ¢Â§çÊåâÈíÆÊñáÊú¨
            if (!document.getElementById('level2Button').disabled) {
                document.getElementById('level2Button').textContent = 'Á¨¨2ÂÖ≥ - Ê≠£Â∏∏ÈÄüÂ∫¶ üêç';
            }
            if (!document.getElementById('level3Button').disabled) {
                document.getElementById('level3Button').textContent = 'Á¨¨3ÂÖ≥ - Âø´Âø´Ë∑ë üöÄ';
            }
            if (!document.getElementById('level4Button').disabled) {
                document.getElementById('level4Button').textContent = 'Á¨¨4ÂÖ≥ - Ë∂ÖÁ∫ßÂø´ ‚ö° (+1ÂëΩ)';
            }
            if (!document.getElementById('level5Button').disabled) {
                document.getElementById('level5Button').textContent = 'Á¨¨5ÂÖ≥ - Èó™Áîµ‰æ† ‚ö°‚ö°';
            }
            if (!document.getElementById('level6Button').disabled) {
                document.getElementById('level6Button').textContent = 'Á¨¨6ÂÖ≥ - ÂÖâÈÄü üí´';
            }
            if (!document.getElementById('level7Button').disabled) {
                document.getElementById('level7Button').textContent = 'Á¨¨7ÂÖ≥ - ÁªàÊûÅÊåëÊàò üî•';
            }
        }
        
        // ÂºÄÂßãÁâπÂÆöÂÖ≥Âç°
        function startLevel(level) {
            currentLevel = level;
            levelElement.textContent = level;
            
            // Ê†πÊçÆÂÖ≥Âç°ËÆæÁΩÆÈÄüÂ∫¶ÂíåÁîüÂëΩ
            switch(level) {
                case 1:
                    gameSpeed = 200;
                    maxLives = 1;
                    break;
                case 2:
                    gameSpeed = 150;
                    maxLives = 1;
                    break;
                case 3:
                    gameSpeed = 120;
                    maxLives = 1;
                    break;
                case 4:
                    gameSpeed = 100;
                    maxLives = 2; // È¢ùÂ§ñ‰∏ÄÊù°ÂëΩ
                    break;
                case 5:
                    gameSpeed = 80;
                    maxLives = 2;
                    break;
                case 6:
                    gameSpeed = 70;
                    maxLives = 2;
                    break;
                case 7:
                    gameSpeed = 60;
                    maxLives = 2;
                    break;
            }
            
            lives = maxLives;
            updateLivesDisplay();
            
            overlay.style.display = 'none';
            levelSelectDiv.style.display = 'none';
            
            // Êõ¥Êñ∞ÊäÄËÉΩÊòæÁ§∫
            if (skillUnlocked) {
                skillInstruction.style.display = 'block';
            }
            
            if (level === 4 && maxLives === 2) {
                playExtraLifeSound();
                showMessage("Ëé∑ÂæóÈ¢ùÂ§ñÁîüÂëΩÔºÅ", 10, 10);
            }
            
            playLevelUpSound();
            startGame();
        }
        
        // ÈîÆÁõòÊéßÂà∂
        document.addEventListener('keydown', (e) => {
            if (!gameRunning || gamePaused) return;
            
            switch(e.key) {
                case 'ArrowUp':
                    if (dy === 0) {
                        dx = 0;
                        dy = -1;
                    }
                    break;
                case 'ArrowDown':
                    if (dy === 0) {
                        dx = 0;
                        dy = 1;
                    }
                    break;
                case 'ArrowLeft':
                    if (dx === 0) {
                        dx = -1;
                        dy = 0;
                    }
                    break;
                case 'ArrowRight':
                    if (dx === 0) {
                        dx = 1;
                        dy = 0;
                    }
                    break;
                case ' ':
                    e.preventDefault();
                    useSkill();
                    break;
            }
        });
        
        // ÂºÄÂßãÊ∏∏Êàè
        function startGame() {
            if (gameInterval) {
                clearInterval(gameInterval);
            }
            
            const startX = Math.floor(canvas.width / gridSize / 2);
            const startY = Math.floor(canvas.height / gridSize / 2);
            
            snake = [{x: startX, y: startY}];
            dx = 0;
            dy = 0;
            score = 0;
            scoreElement.textContent = score;
            skillCooldown = 0;
            initializeFoods();
            gameRunning = true;
            gamePaused = false;
            
            // ÊòæÁ§∫ÊàñÈöêËóèËß¶Êë∏ÊéßÂà∂
            if (isMobile) {
                touchControls.style.display = 'grid';
            }
            
            updateSkillButton();
            
            gameInterval = setInterval(update, gameSpeed);
            
            draw();
        }
        
        // ÊöÇÂÅúÊ∏∏Êàè
        function pauseGame() {
            if (gameRunning) {
                gamePaused = !gamePaused;
            }
        }
        
        // ÈáçÊñ∞ÂºÄÂßã
        function restartGame() {
            overlay.style.display = 'none';
            gameOverDiv.style.display = 'none';
            totalGameScore = 0;
            startLevel(currentLevel);
        }
        
        // Âä†ËΩΩ‰øùÂ≠òÁöÑËøõÂ∫¶
        function loadProgress() {
            const saved = localStorage.getItem('completedLevels');
            if (saved) {
                completedLevels = JSON.parse(saved);
            }
            
            const skillSaved = localStorage.getItem('skillUnlocked');
            if (skillSaved === 'true') {
                skillUnlocked = true;
            }
        }
        
        // ÂàùÂßãÂåñ
        loadProgress();
        initializeFoods();
        draw();
    </script>
</body>
</html>
